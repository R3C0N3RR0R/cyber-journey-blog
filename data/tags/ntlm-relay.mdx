---
title: NTLM Relay
date: "2025-07-15"
draft: false
---

# üîÑ NTLM Relay

## Qu'est-ce que le NTLM Relay ?

Le **NTLM Relay** est une attaque qui exploite le protocole d'authentification NTLM de Microsoft. Elle consiste √† intercepter une authentification NTLM l√©gitime et √† la relayer vers un autre service pour obtenir un acc√®s non autoris√©.

## üéØ Objectifs p√©dagogiques

- Comprendre le fonctionnement du protocole NTLM
- Savoir comment une attaque de relayage NTLM est r√©alis√©e
- Identifier les risques associ√©s √† l'absence de signature SMB

## üìã Exemples de vuln√©rabilit√©s et exploitation

### Vuln√©rabilit√©s courantes

- **Absence de signature SMB** : Permet le relayage vers des partages de fichiers.
- **Services HTTP acceptant NTLM** : Certains serveurs web internes acceptent l'authentification NTLM et sont vuln√©rables au relay.
- **Mauvaise segmentation r√©seau** : Permet de relayer les identifiants sur d'autres machines du r√©seau.

### Sc√©nario d'exploitation

1. **Attaque sur un partage SMB** :
   - L'attaquant attend qu'une victime tente d'acc√©der √† un partage contr√¥l√© par l'attaquant (ex : via un lien malicieux ou une attaque LLMNR/NBT-NS spoofing).
   - L'attaquant relaie l'authentification NTLM re√ßue vers un autre serveur SMB vuln√©rable.
2. **Relay HTTP ‚Üí SMB** :
   - Certains outils permettent de relayer une authentification HTTP NTLM vers un partage SMB.

### Commandes d'exploitation avec impacket

```bash
# Lancer un serveur relay SMB ‚Üí SMB
sudo ntlmrelayx.py -t smb://10.10.10.2

# Relay HTTP ‚Üí SMB
sudo ntlmrelayx.py -t smb://10.10.10.2 --http-port 8080

# Attaque combin√©e avec Responder pour capturer les identifiants
sudo responder -I eth0
```

### Exploitation avanc√©e

- **Ajout d'un nouvel utilisateur local** :
  - Si le serveur cible autorise l'ex√©cution de commandes via SMB (ex : interface d'administration), il est possible de cr√©er un nouvel utilisateur ou d'ajouter l'attaquant √† un groupe privil√©gi√©.

```bash
# Ajout d'un utilisateur via ntlmrelayx (si privil√®ges suffisants)
ntlmrelayx.py -t smb://10.10.10.2 --add-user hacker:Password123!
```

## üõ°Ô∏è Bonnes pratiques

- Activer la signature SMB sur tous les serveurs
- Privil√©gier Kerberos √† NTLM pour l'authentification
- Segmenter le r√©seau pour limiter les mouvements lat√©raux
- Surveiller les tentatives de connexion suspectes

## üìö Ressources utiles

- [HackTricks - NTLM Relay](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/ntlm-relay)
- [Microsoft - NTLM Relay](https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/ntlm-relay)
- [Impacket - ntlmrelayx](https://github.com/fortra/impacket/blob/master/examples/ntlmrelayx.py)

---

_Derni√®re mise √† jour : 15 juillet 2025_
