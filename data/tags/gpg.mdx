---
title: GPG
date: "2025-08-25"
draft: false
---

# üîê GPG ‚Äî D√©chiffrement : guide rapide

## üéØ L‚Äôessentiel

- **GPG**: un outil pour prot√©ger des fichiers/messages.
- Deux modes principaux:
  - **Sym√©trique**: un mot de passe unique sert √† chiffrer et √† d√©chiffrer.
  - **Asym√©trique**: chiffr√© pour une personne avec sa cl√© publique; seul sa cl√© priv√©e peut d√©chiffrer.

---

## üîé Avant de commencer: identifier votre fichier

- Extensions fr√©quentes: `.gpg`, `.pgp`, `.asc` (texte lisible) ‚Äî les commandes sont les m√™mes.
- Si on vous a donn√© un **mot de passe**, c‚Äôest probablement du sym√©trique.
- Si on vous a ¬´ envoy√© pour vous ¬ª sans mot de passe, c‚Äôest probablement de l‚Äôasym√©trique (il vous faut votre **cl√© priv√©e**).

---

## üü¢ Cas 1 ‚Äî D√©chiffrer avec un mot de passe (sym√©trique)

1. Lancez le d√©chiffrement (vous serez invit√© √† entrer le mot de passe):

```bash
gpg -d secret.gpg
```

2. Pour enregistrer directement le r√©sultat dans un fichier:

```bash
gpg -o secret.txt -d secret.gpg
```

Astuce: pour un fichier `.asc` (texte), utilisez aussi `-d` de la m√™me fa√ßon.

---

## üîµ Cas 2 ‚Äî D√©chiffrer ¬´ pour vous ¬ª (asym√©trique)

Vous devez poss√©der la **cl√© priv√©e** correspondant √† votre **cl√© publique** utilis√©e pour chiffrer.

1. Importer votre cl√© priv√©e (si ce n‚Äôest pas d√©j√† fait):

```bash
gpg --import ma_cle_privee.asc
```

2. V√©rifier que GPG voit bien vos cl√©s:

```bash
gpg --list-keys
gpg --list-secret-keys
```

3. D√©chiffrer le fichier:

```bash
gpg -o message.txt -d message.gpg
```

Si une passphrase prot√®ge votre cl√© priv√©e, GPG vous la demandera.

---

## üü† Cas 3 ‚Äî Vos cl√©s sont dans un dossier s√©par√©

Utilisez `--homedir` pour dire √† GPG o√π sont vos cl√©s, et assurez-vous des bonnes permissions:

```bash
mkdir -p /tmp/gpg_env && chmod 700 /tmp/gpg_env
# Copiez vos fichiers de cl√©s dans /tmp/gpg_env si besoin
gpg --homedir /tmp/gpg_env --list-secret-keys
gpg --homedir /tmp/gpg_env -o out.txt -d fichier.gpg
```

---

## ü§ñ (Optionnel) Mode non interactif / automatisation

Utile pour des scripts (√† manipuler avec pr√©caution):

```bash
gpg --batch --yes --pinentry-mode loopback --passphrase 'VotrePassphrase' \
  -o out.txt -d secret.gpg

# Variante: √©viter la passphrase en clair dans la ligne de commande
echo 'VotrePassphrase' | gpg --batch --yes --pinentry-mode loopback --passphrase-fd 0 \
  -o out.txt -d secret.gpg
```

---

## ü©∫ D√©pannage simple

- ¬´ decryption failed: No secret key ¬ª
  - Cas asym√©trique: vous n‚Äôavez pas la bonne cl√© priv√©e. Importez-la puis r√©essayez.
  - Cas sym√©trique: entrez le bon mot de passe (pas besoin de cl√©).
  - Pour comprendre √† qui le fichier est destin√©:

```bash
gpg -vv -d fichier.gpg |& grep -i keyid
```

- ¬´ Bad session key ¬ª / ¬´ Wrong secret key ¬ª
  - Mauvaise cl√© ou mauvais mot de passe, ou mauvais dossier de cl√©s (`--homedir`).
  - Red√©marrer l‚Äôagent peut aider:

```bash
gpgconf --kill gpg-agent
```

- ¬´ unsafe ownership on homedir ¬ª (permissions incorrectes)

```bash
chmod 700 dossier_gpg
chmod 600 dossier_gpg/private-keys-v1.d/* 2>/dev/null || true
chmod 644 dossier_gpg/pubring.kbx 2>/dev/null || true
```

- R√©sultat illisible √† l‚Äô√©cran? √âcrivez dans un fichier:

```bash
gpg -o resultat.txt -d fichier.gpg
```

---

## ‚úÖ Bonnes pratiques

- Ne tapez pas votre passphrase dans des commandes qui seront enregistr√©es dans l‚Äôhistorique; pr√©f√©rez `read -s` ou `passphrase-fd`.
- Prot√©gez vos cl√©s: dossier en `700`, cl√©s priv√©es en `600`.
- Nettoyez les fichiers sensibles apr√®s usage.

_Derni√®re mise √† jour : 25 ao√ªt 2025_
